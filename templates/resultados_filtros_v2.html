{% extends 'site_content.html' %}
{% load static %}

<!-- Escribir en este bloque todo lo que haga falta-->
{% block site_content %}

{% if messages %}
{% for message in messages %}
<div class="container-fluid p-0">
    <div class="alert alert-{{ message.tags }} alert-dismissible" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        {{ message }}
    </div>
</div>
{% endfor %}
{% endif %}


<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">¿Cómo está mi campo?</h1>
</div>
<div class="card text-center">
    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs">
            <li class="nav-item">
                <a class="nav-link active" id="pill-mejor-rinde-tab" data-toggle="pill" href="#mejor-rinde-tab"
                    role="tab" aria-controls="pill-mejor-rinde-tab" aria-selected="true">Mejor Rinde</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="pill-peor-rinde-tab" data-toggle="pill" href="#peor-rinde-tab" role="tab"
                    aria-controls="pill-peor-rinde-tab" aria-selected="false">Peor Rinde</a>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade show active" id="mejor-rinde-tab" role="tabpanel"
                aria-labelledby="mejor-rinde-tab">
                <div class="container">
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">El mejor año en cuanto a rinde fue en el {{anio}}</h1>
                    </div>
                    <div class="row">


                        {{resultados.items}}
                        {% for key, value in resultados.items %}
                        {{ key }}: {{ value }}
                        {% endfor %}

                        {% for mes in resultados.meses %}
                        {{mes.promtemmax}}
                        {{mes}}
                        {% endfor %}
                        {% for mes in meses %}
                        {{mes.promtemmax}}
                        {{mes}}
                        {{meses.mes.promtemmax}}
                        {% endfor %}


                    </div>
                    <h1 class="h3 mb-0 text-gray-800">SEPARACION</h1>
                    <div class="row">
                        {% for mes in meses%}
                        <div class="col-">
                            <div class="card" style="width: 14rem;">
                                <div class="card-header">
                                    <h6 class="m-0 font-weight-bold text-primary">{{mes}}</h6>
                                </div>
                                <div class="card-body">
                                    <img class="img-thumbnail mx-auto border-0" style="width: 5rem;"
                                        src="{% static 'img/soleado.svg' %}" alt="...">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-md-6 col-sm-6">
                                                <h6 class="card-subtitle mb-2 text-muted">Max {{mes.promtemmax}}°
                                                </h6>
                                            </div>
                                            <div class="col-md-6 col-sm-6">
                                                <h6 class="card-subtitle mb-2 text-muted">Min {{mes.promtemmin}}°
                                                </h6>
                                            </div>
                                        </div>
                                    </div>

                                    <a class="card-link" data-toggle="collapse" href="#collapse{{mes}}"
                                        onclick="graficar('myChart1','myChart5','{{mes}}')">
                                        Ver mes
                                    </a>

                                </div>
                            </div>
                        </div>
                        <div class="collapse col-md-12 col-sm-12" id="collapse{{mes}}">
                            <!-- Card Body -->
                            <div class="card-body">
                                <div class="card-header">
                                    <ul class="nav nav-tabs card-header-tabs">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="pill-tab-temperatura-enero"
                                                data-toggle="pill" href="#tab-temperatura-enero" role="tab"
                                                aria-controls="pill-tab-temperatura-enero"
                                                aria-selected="true">Temperatura</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="pill-tab-lluvia-enero" data-toggle="pill"
                                                href="#tab-lluvia-enero" role="tab"
                                                aria-controls="pill-tab-lluvia-enero"
                                                aria-selected="false">Precipitaciones</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="tab-content" id="pills-tabContent-graficos">
                                    <div class="tab-pane fade show active" id="tab-temperatura-enero" role="tabpanel"
                                        aria-labelledby="tab-temperatura-enero">
                                        <div class="chart-area">
                                            <div class="chartjs-size-monitor">
                                                <div class="chartjs-size-monitor-expand">
                                                    <div class=""></div>
                                                </div>
                                                <div class="chartjs-size-monitor-shrink">
                                                    <div class=""></div>
                                                </div>
                                            </div>
                                            <canvas id="myChart1" style="display: block; width: 996px; height: 320px;"
                                                width="996" height="320" class="chartjs-render-monitor"></canvas>
                                        </div>
                                    </div>

                                    <div class="tab-pane fade" id="tab-lluvia-enero" role="tabpanel"
                                        aria-labelledby="tab-lluvia-enero">
                                        <div class="chart-area">
                                            <div class="chartjs-size-monitor">
                                                <div class="chartjs-size-monitor-expand">
                                                    <div class=""></div>
                                                </div>
                                                <div class="chartjs-size-monitor-shrink">
                                                    <div class=""></div>
                                                </div>
                                            </div>
                                            <canvas id="myChart5" style="display: block; width: 996px; height: 320px;"
                                                width="996" height="320" class="chartjs-render-monitor"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {%endfor%}
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="peor-rinde-tab" role="tabpanel" aria-labelledby="peor-rinde-tab">

                <div class="card-header py-3" style="text-align: left;">
                    <h6 class="m-0 font-weight-bold text-primary">
                        Vale la pena que en una consulta te traiga mejor y peor?
                    </h6>
                </div>
                <div class="card-body">
                    <div id="map" style="height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div>
    Iconos diseñados por
    <a href="https://www.freepik.com" title="Freepik">Freepik</a> from
    <a href="https://www.flaticon.es/" title="Flaticon">www.flaticon.es</a>
</div>

<script type="text/javascript">

    var resultados = []
    if ('{{resultados|safe}}') {
        resultados = JSON.parse('{{resultados|safe}}');
    }

    console.log(resultados);
    console.log(resultados.meses.enero);

    function armar_datos_temperatura(mes) {
        var labels = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
        const datos = {
            labels: labels,
            datasets: [
                {
                    label: 'Maxima',
                    data: [
                        resultados.meses[mes].dia1.tmpmax,
                        resultados.meses[mes].dia2.tmpmax,
                        resultados.meses[mes].dia3.tmpmax,
                        resultados.meses[mes].dia4.tmpmax,
                        resultados.meses[mes].dia5.tmpmax,
                        resultados.meses[mes].dia6.tmpmax,
                        resultados.meses[mes].dia7.tmpmax,
                        resultados.meses[mes].dia8.tmpmax,
                        resultados.meses[mes].dia9.tmpmax,
                        resultados.meses[mes].dia10.tmpmax,
                    ],
                    borderColor: 'rgb(255, 99, 132)',
                    fill: false,
                    //backgroundColor: 'rgb(255, 99, 132,0.5)',
                },
                {
                    label: 'Minima',
                    data: [
                        resultados.meses[mes].dia1.tmpmin,
                        resultados.meses[mes].dia2.tmpmin,
                        resultados.meses[mes].dia3.tmpmin,
                        resultados.meses[mes].dia4.tmpmin,
                        resultados.meses[mes].dia5.tmpmin,
                        resultados.meses[mes].dia6.tmpmin,
                        resultados.meses[mes].dia7.tmpmin,
                        resultados.meses[mes].dia8.tmpmin,
                        resultados.meses[mes].dia9.tmpmin,
                        resultados.meses[mes].dia10.tmpmin,
                    ],
                    borderColor: 'rgb(54, 162, 235)',
                    fill: false,
                    //backgroundColor: 'rgb(54, 162, 235,0.5)',
                }
            ]
        };
        return datos;
    }

    function configurar_grafico_linea(datos_armados, mes) {
        const config = {
            type: 'line',
            data: datos_armados,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Temperaturas ' + mes
                    }
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'grados'
                        }
                    }],
                    xAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'días'
                        }
                    }]
                }
            },
        };
        return config;
    }

    function armar_datos_lluvia(mes) {
        //console.log(datos[mes].dia1)
        var labels = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
        const datos = {
            labels: labels,
            datasets: [
                {
                    label: 'Lluvia',
                    data: [
                        resultados.meses[mes].dia1.precipitacion,
                        resultados.meses[mes].dia2.precipitacion,
                        resultados.meses[mes].dia3.precipitacion,
                        resultados.meses[mes].dia4.precipitacion,
                        resultados.meses[mes].dia5.precipitacion,
                        resultados.meses[mes].dia6.precipitacion,
                        resultados.meses[mes].dia7.precipitacion,
                        resultados.meses[mes].dia8.precipitacion,
                        resultados.meses[mes].dia9.precipitacion,
                        resultados.meses[mes].dia10.precipitacion,
                    ],
                    borderColor: 'rgb(54, 162, 235)',
                    backgroundColor: 'rgb(54, 162, 235, 0.5)',
                },
            ]
        };
        return datos;
    }

    function configurar_grafico_barra(datos_armados, mes) {
        const config = {
            type: 'bar',
            data: datos_armados,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Precipitaciones ' + mes
                    }
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'mm'
                        }
                    }],
                    xAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: 'días'
                        }
                    }]
                }
            },
        };
        return config;
    }

    function grafico_linea(id_tempertaura, mes) {
        console.log(id_tempertaura, mes);
        datos_armados = armar_datos_temperatura(mes);
        configuracion = configurar_grafico_linea(datos_armados, mes);
        var canvas_line = document.getElementById(id_tempertaura).getContext("2d");
        window.myLine = new Chart(canvas_line, configuracion);
    }

    function grafico_barras(id_lluvia, mes) {
        console.log(id_lluvia, mes);
        datos_armados = armar_datos_lluvia(mes);
        configuracion = configurar_grafico_barra(datos_armados, mes);
        var canvas_bar = document.getElementById(id_lluvia).getContext("2d");
        window.myBar = new Chart(canvas_bar, configuracion);
    }

    function graficar(id_tempertaura, id_lluvia, mes) {
        grafico_linea(id_tempertaura, mes);
        grafico_barras(id_lluvia, mes);
    }
</script>
{% endblock %}